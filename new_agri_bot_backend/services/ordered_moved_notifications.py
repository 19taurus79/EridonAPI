import asyncio

import pandas as pd
from aiogram import Bot
from pandas import Timestamp

from new_agri_bot_backend.config import TELEGRAM_BOT_TOKEN
from new_agri_bot_backend.services.send_telegram_notification import send_notification
from new_agri_bot_backend.tables import Submissions

test_dict = {
    "contract": [
        "–¢–ï-00069703",
        "–¢–ï-00069703",
        "–¢–ï-00069703",
        "–¢–ï-00072694",
        "–¢–ï-00071267",
        "–¢–ï-00071126",
        "–¢–ï-00068466",
        "–¢–ï-00071325",
        "–¢–ï-00071325",
        "–¢–ï-00071325",
        "–¢–ï-00072828",
        "–¢–ï-00071124",
        "–¢–ï-00071391",
        "–¢–ï-00071859",
        "–¢–ï-00069873",
        "–¢–ï-00071282",
        "–¢–ï-00071859",
        "–¢–ï-00068888",
        "–¢–ï-00071300",
        "–¢–ï-00072806",
        "–¢–ï-00072041",
        "–¢–ï-00072434",
        "–¢–ï-00072694",
        "–¢–ï-00070723",
        "–¢–ï-00071753",
        "–¢–ï-00072434",
        "–¢–ï-00072646",
        "–¢–ï-00071753",
        "–¢–ï-00071125",
        "–¢–ï-00072390",
        "–¢–ï-00072983",
        "–¢–ï-00072971",
        "–¢–ï-00072779",
        "–¢–ï-00071938",
        "–¢–ï-00072237",
        "–¢–ï-00073077",
        "–¢–ï-00073115",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00027284",
        "–¢–ï-00073115",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00069372",
        "–¢–ï-00069372",
        "–¢–ï-00069372",
        "–¢–ï-00069372",
        "–¢–ï-00069372",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00073115",
        "–¢–ï-00073209",
        "–¢–ï-00073209",
        "–¢–ï-00071128",
        "–¢–ï-00072647",
        "–¢–ï-00072557",
        "–¢–ï-00072237",
    ],
    "date": [
        Timestamp("2025-10-07 00:00:00"),
        Timestamp("2025-10-07 00:00:00"),
        Timestamp("2025-10-07 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-30 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
        Timestamp("2025-10-29 00:00:00"),
    ],
    "line_of_business": [
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ó–ó–†",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
        "–ù–∞—Å—ñ–Ω–Ω—è",
    ],
    "order": [
        "–¢–ï-00289307",
        "–¢–ï-00289307",
        "–¢–ï-00289307",
        "–¢–ï-00290693",
        "–¢–ï-00290693",
        "–¢–ï-00290695",
        "–¢–ï-00290697",
        "–¢–ï-00290700",
        "–¢–ï-00290700",
        "–¢–ï-00290700",
        "–¢–ï-00290702",
        "–¢–ï-00290703",
        "–¢–ï-00290705",
        "–¢–ï-00290710",
        "–¢–ï-00290712",
        "–¢–ï-00290714",
        "–¢–ï-00290715",
        "–¢–ï-00290716",
        "–¢–ï-00290717",
        "–¢–ï-00290717",
        "–¢–ï-00290717",
        "–¢–ï-00290718",
        "–¢–ï-00290718",
        "–¢–ï-00290719",
        "–¢–ï-00290721",
        "–¢–ï-00290722",
        "–¢–ï-00290722",
        "–¢–ï-00290722",
        "–¢–ï-00290723",
        "–¢–ï-00290726",
        "–¢–ï-00290726",
        "–¢–ï-00290726",
        "–¢–ï-00290726",
        "–¢–ï-00290727",
        "–¢–ï-00290727",
        "–¢–ï-00290761",
        "–¢–ï-00290853",
        "–¢–ï-00290854",
        "–¢–ï-00290856",
        "–¢–ï-00290856",
        "–¢–ï-00290858",
        "–¢–ï-00290859",
        "–¢–ï-00290861",
        "–¢–ï-00290862",
        "–¢–ï-00290863",
        "–¢–ï-00290864",
        "–¢–ï-00290864",
        "–¢–ï-00290864",
        "–¢–ï-00290864",
        "–¢–ï-00290864",
        "–¢–ï-00290865",
        "–¢–ï-00290866",
        "–¢–ï-00290869",
        "–¢–ï-00290869",
        "–¢–ï-00290870",
        "–¢–ï-00290871",
        "–¢–ï-00290871",
        "–¢–ï-00290872",
        "–¢–ï-00290873",
        "–¢–ï-00290875",
        "–¢–ï-00290876",
        "–¢–ï-00290707",
        "–¢–ï-00290720",
        "–¢–ï-00290720",
    ],
    "party_sign": [
        "UA-04-007/0557-21",
        "UA-04-007/0558-21",
        "UA-04-007/0559-21",
        "ESP-V24-519-057",
        "TR.26.22.1154.R.133801",
        "UA-10-0014/00471-22",
        "UA-24-0123/01005-24",
        "UA-24-123/0325-21",
        "UA-24-123/0328-21",
        "UA-24-123/0331-21",
        "TR.00.00.1265.R.3002",
        "TR.42.24.1265.R.0006",
        "UA-10-0014/00456-23",
        "TR.42.23.1154.R.134641",
        "H-22-096/0195",
        "UA-24-0216/00450-24",
        "TR.06.24.1154.R.125988",
        "UA-24-0058/01656-24",
        "UA-24-0058/01645-23",
        "UA-24-0058/01645-23",
        "UA-24-0058/01645-23",
        "UA-24-0216/00486-24",
        "UA-24-0216/00486-24",
        "TR.42.24.1154.R.135951",
        "ESP-X25-519-011",
        "ESP-W24-519-094",
        "TR.26.24.1154.R.136254",
        "TR.26.24.1154.R.136254",
        "UA-16-047/0073-23",
        "UA-16-0047/00126-24",
        "UA-16-0047/00126-24",
        "UA-16-0047/00126-24",
        "UA-16-0047/00126-24",
        "UA-24-0216/00458-24",
        "UA-24-0216/00458-24",
        "UA-24-0216/00460-24",
        "54102224U0",
        "25I2754005",
        "S962020006",
        "S962100020",
        "229594",
        "28804198",
        "C190G25005",
        "24RFA3357",
        "20241125",
        "28685797",
        "28716265",
        "28947023",
        "28947030",
        "28985051",
        "EV58004719",
        "WF-202504",
        "28685329",
        "29009464",
        "B146G25001",
        "NC20241125",
        "NC20250225",
        "C18B25",
        "FE20250207",
        "28762168E0",
        "25RFA2718",
        "UA-24-123/0279-21",
        "H-24-096/1032",
        "H-24-096/1032",
    ],
    "period": [
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2026",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2025",
        "2026",
        "2026",
        "2026",
        "2026",
    ],
    "product": [
        "–ë–ª–µ–∫—Ä–æ–∫ —ñ–Ω—Å. —É–∫—Ä. (80–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2022",
        "–ë–ª–µ–∫—Ä–æ–∫ —ñ–Ω—Å. —É–∫—Ä. (80–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2022",
        "–ë–ª–µ–∫—Ä–æ–∫ —ñ–Ω—Å. —É–∫—Ä. (80–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2022",
        "–ê–ª—å–∫–∞–Ω—Ç–∞—Ä–∞ —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–ê–ª—å–∫–∞–Ω—Ç–∞—Ä–∞ —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–ï–∫–∫—Å–∫–ª–∞–º —ñ–Ω—Å. —É–∫—Ä. (50–ö) –≤–ª–∞—Å–Ω–µ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ 2025",
        "–ï–° –ë–µ–ª—Ñ—ñ—Å –ö–õ–ü —ñ–Ω—Å. –ë—É—Å—Ç (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2025",
        "–õ–ì30273 —ñ–Ω—Å. —É–∫—Ä. (50–ö) –≤–ª–∞—Å–Ω–µ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ 2022",
        "–õ–ì30273 —ñ–Ω—Å. —É–∫—Ä. (50–ö) –≤–ª–∞—Å–Ω–µ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ 2022",
        "–õ–ì30273 —ñ–Ω—Å. —É–∫—Ä. (50–ö) –≤–ª–∞—Å–Ω–µ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ 2022",
        "–õ–ì50501 –ö–õ–ü —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2025",
        "–õ–ì50550 –ö–õ–ü —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2025",
        "–õ–ì5555 –ö–õ–ü —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2024",
        "–°–ò –Ü—Ä—ñ—Å–∞ –ê–† —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –ï–∫—Å–ø–µ—Ä—Ç–æ –ö–õ –í–û —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2023",
        "–°–ò –ï–∫—Å–ø–µ—Ä—Ç–æ –ö–õ –í–û —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –ö–û–†–°–Ü–ö–ê –ê–† —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –ö–û–†–°–Ü–ö–ê –ê–† —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –õ–∞–∑—É—Ä—ñ –ö–õ–ü —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –õ–∞–∑—É—Ä—ñ –ö–õ–ü —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –õ–∞–∑—É—Ä—ñ –ö–õ–ü —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –õ–∞—Å–∫–∞–ª–∞ —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –õ–∞—Å–∫–∞–ª–∞ —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –ú—ñ—á—ñ–≥–∞–Ω –ö–õ–ü —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–£–ù–ê–†–Ü–° –°—É–ª—å—Ñ–æ —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–∞–π–±–µ—Ä—ñ–∫ –°—É–ª—å—Ñ–æ —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–∞–π–±–µ—Ä—ñ–∫ –°—É–ª—å—Ñ–æ —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–∞–π–±–µ—Ä—ñ–∫ –°—É–ª—å—Ñ–æ —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–∞–Ω—Ä–æ–∫ –°—É–ª—å—Ñ–æ —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2024",
        "–°–∞–Ω—Ä–æ–∫ –°—É–ª—å—Ñ–æ —ñ–Ω—Å. —É–∫—Ä. (150–ö) —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ 2025",
        "–°–∞–Ω—Ä–æ–∫ –°—É–ª—å—Ñ–æ —ñ–Ω—Å. —É–∫—Ä. (150–ö) —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ 2025",
        "–°–∞–Ω—Ä–æ–∫ –°—É–ª—å—Ñ–æ —ñ–Ω—Å. —É–∫—Ä. (150–ö) —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ 2025",
        "–°–∞–Ω—Ä–æ–∫ –°—É–ª—å—Ñ–æ —ñ–Ω—Å. —É–∫—Ä. (150–ö) —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ 2025",
        "–°—É—Ä–µ—Å—Ç –°—É–ª—å—Ñ–æ —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°—É—Ä–µ—Å—Ç –°—É–ª—å—Ñ–æ —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°—É—Ä–µ—Å—Ç –°—É–ª—å—Ñ–æ —ñ–Ω—Å. —É–∫—Ä. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–ë—É—Ç—ñ–∑–∞–Ω 400 –∫.—Å. (5 –ª)",
        "–í—ñ–≤–æ–ª—Ç, –ü–ê–† (–ø—Ä–∏–ª–∏–ø–∞—á) (5 –ª)",
        "–î–µ–ª—É–≥–µ 96%, –∫.–µ. (5 –ª)",
        "–î–µ–ª—É–≥–µ 96%, –∫.–µ. (5 –ª)",
        "–ï–∫—Å–ø—Ä–µ—Å –ì–æ–ª–¥ (0,350 –∫–≥)",
        "–Ñ–≤—Ä–æ-–ª–∞–π—Ç–Ω—ñ–Ω–≥ 48%, –≤.—Ä. (10 –ª)",
        "–ö–∞—Ç–∞–¥—ñ–Ω 11,2%, –∫.–µ. (1–ª)",
        "–ö–ª–µ–≤–µ—Ä–¥–∏–º –ì—Ä–∞–Ω–¥ 36%, –∫.–µ. (10 –ª)",
        "–û–ª—Ä–∞–π—Ç 90% –∫.–µ. (20 –ª)",
        "–ü—Ä—ñ–∞–∫—Å–æ—Ä 22,5%, –∫.–µ. (5 –ª)",
        "–ü—Ä—ñ–∞–∫—Å–æ—Ä 22,5%, –∫.–µ. (5 –ª)",
        "–ü—Ä—ñ–∞–∫—Å–æ—Ä 22,5%, –∫.–µ. (5 –ª)",
        "–ü—Ä—ñ–∞–∫—Å–æ—Ä 22,5%, –∫.–µ. (5 –ª)",
        "–ü—Ä—ñ–∞–∫—Å–æ—Ä 22,5%, –∫.–µ. (5 –ª)",
        "–ü—Ä–æ–ø—É–ª—å—Å 25%, —Å.–µ. (5 –ª)",
        "–ü—Ä–æ-–°—Ç–∞—Ä 500, –ö–° (20 –ª)",
        "–ü—É–ª—å—Å–∞—Ä –§–ª–µ–∫—Å 2,5%, –∫,–µ, (10 –ª)",
        "–ü—É–ª—å—Å–∞—Ä –§–ª–µ–∫—Å 2,5%, –∫,–µ, (10 –ª)",
        "–†–∞–π–Ω–µ—Ä –°—Ç–∞—Ä 20% –≤.—Ä. (1 –ª)",
        "–¢–∞–π–≥–µ–¥–µ—Ä 72%, –∫.–µ. (20 –ª)",
        "–¢–∞–π–≥–µ–¥–µ—Ä 72%, –∫.–µ. (20 –ª)",
        "–¢–µ—Ñ–ª—ñ–∫—Å –≤.–≥. (10 –∫–≥)",
        "–¢—Ä—ñ–∞—Ñ–µ—Ä –ì–æ–ª–¥ 500, –∫.—Å. (10 –ª)",
        "–¢—É—Ä–±–æ 21% (5 –∫–≥)",
        "–ù—ñ–∫–æ—Ñ—É—Ä –§–ª–æ 4%, –ú–î (5 –ª)",
        "–ú–∞–∫–∫—Å–∞–ª—ñ—è —ñ–Ω—Å. —É–∫—Ä. (50–ö) –≤–ª–∞—Å–Ω–µ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ 2024",
        "–°–ò –¢–µ–æ—Å —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
        "–°–ò –¢–µ–æ—Å —ñ–Ω—Å. (150–ö) –∑–≤–∏—á–∞–π–Ω–∞ 2026",
    ],
    "product_id": [
        "217c0e75-c1c5-46f9-90e0-a6fa9941a18e",
        "217c0e75-c1c5-46f9-90e0-a6fa9941a18e",
        "217c0e75-c1c5-46f9-90e0-a6fa9941a18e",
        "2659054c-5755-404b-82b5-7610ac10db64",
        "2659054c-5755-404b-82b5-7610ac10db64",
        "bdb942cf-6233-43f6-836e-cb33ac19e52c",
        "9d50a00b-4fbd-4bd6-8e89-6b9dd23a6f97",
        "be7eef76-caea-4887-a3c0-9e01bb737c01",
        "be7eef76-caea-4887-a3c0-9e01bb737c01",
        "be7eef76-caea-4887-a3c0-9e01bb737c01",
        "4739d761-b643-42d1-8044-061f7c515f5c",
        "66728e01-e10c-416e-9d20-a391377dca9e",
        "8f2134da-729f-43a1-bfa1-c1c7f22af2b2",
        "6a3ff0d1-cb0e-40b9-969a-b5c221efebdd",
        "58e39b2d-af83-4b12-a345-030f7d533231",
        "cb4b130c-e10b-4337-ad08-4763b60f0c3f",
        "d6c43da4-a876-45df-9813-c39b2ed5d3b4",
        "d13aeb21-adf9-423b-891d-249f82c63ac6",
        "ed30998d-9c8a-47d2-8808-6f82bed65863",
        "ed30998d-9c8a-47d2-8808-6f82bed65863",
        "ed30998d-9c8a-47d2-8808-6f82bed65863",
        "a6cb5b45-b391-49ee-826c-68ec6b632d6c",
        "a6cb5b45-b391-49ee-826c-68ec6b632d6c",
        "42a22688-6e8d-4316-a3c2-88e0ff15c69a",
        "af4e74ea-13e0-4750-83ba-69b3a6eed2de",
        "8622d4d0-9f18-4393-8455-71cbe97e1b42",
        "8622d4d0-9f18-4393-8455-71cbe97e1b42",
        "8622d4d0-9f18-4393-8455-71cbe97e1b42",
        "95d98bcf-be67-442c-a897-934c80c70853",
        "679ff967-af22-48c7-a1bb-3d3723089942",
        "679ff967-af22-48c7-a1bb-3d3723089942",
        "679ff967-af22-48c7-a1bb-3d3723089942",
        "679ff967-af22-48c7-a1bb-3d3723089942",
        "e9b3a396-f797-4088-94c3-a2e432905acd",
        "e9b3a396-f797-4088-94c3-a2e432905acd",
        "e9b3a396-f797-4088-94c3-a2e432905acd",
        "593f95e2-79c2-47d7-bc25-86c3af6d6f1c",
        "c6aa2765-9b8f-44d4-86ae-397f2a4e453a",
        "228ded30-8bb2-44cc-a2bf-a6f63d014428",
        "228ded30-8bb2-44cc-a2bf-a6f63d014428",
        "94d3fca7-ed8b-48a9-ab43-151b8a5437de",
        "6521d772-f6ad-4f19-aac5-a44276c6adb6",
        "2546536c-b766-419f-ab2b-1fda6a94d927",
        "08b49204-cdf2-406d-9b36-6f2bc9a2ea75",
        "7fcb286a-a5f3-4c48-b16c-2ce2228f0014",
        "28e30214-a929-4c09-9b10-0a254759a81b",
        "28e30214-a929-4c09-9b10-0a254759a81b",
        "28e30214-a929-4c09-9b10-0a254759a81b",
        "28e30214-a929-4c09-9b10-0a254759a81b",
        "28e30214-a929-4c09-9b10-0a254759a81b",
        "ee89111c-2628-46a6-9a20-efbae9b1e1b6",
        "bb52d367-402f-4982-8fe7-cd3ae4961f8f",
        "6a1b3c90-b82b-4925-aa53-f0bf8bcff63e",
        "6a1b3c90-b82b-4925-aa53-f0bf8bcff63e",
        "2d329731-6167-452b-92c8-eb469755d0c9",
        "018488b5-f2d7-4c0e-8a2f-386a02f1c9ff",
        "018488b5-f2d7-4c0e-8a2f-386a02f1c9ff",
        "751b4679-79fc-44a2-98a1-cbd446b6db35",
        "009ecfba-3ebb-494f-8ea4-45bd99c098cc",
        "66948e1a-5f8c-4b07-a49a-669bc2549d59",
        "ed48b209-11ef-4f4b-b573-8f392d8cce66",
        "8ec7a00b-7c0e-480d-8a1b-46a73335a200",
        "897341cf-35dd-4f7e-aa3e-0296b8012bd9",
        "897341cf-35dd-4f7e-aa3e-0296b8012bd9",
    ],
    "qt_moved": [
        "1",
        "69",
        "24",
        "54",
        "5",
        "35",
        "50",
        "21",
        "3",
        "223",
        "170",
        "15",
        "18",
        "10",
        "55",
        "186",
        "4",
        "15",
        "50",
        "8",
        "5",
        "1",
        "106",
        "15",
        "6",
        "1",
        "8",
        "8",
        "23",
        "12",
        "30",
        "25",
        "10",
        "85",
        "6",
        "1589",
        "5",
        "235",
        "115",
        "155",
        "5",
        "10",
        "3",
        "40",
        "20",
        "10",
        "45",
        "15",
        "20",
        "110",
        "105",
        "840",
        "10",
        "580",
        "70",
        "220",
        "200",
        "10",
        "20",
        "35",
        "150",
        "13",
        "33",
        "10",
    ],
    "qt_order": [
        "94.0",
        "94.0",
        "94.0",
        "59.0",
        "59.0",
        "35.0",
        "50.0",
        "247.0",
        "247.0",
        "247.0",
        "170.0",
        "15.0",
        "18.0",
        "10.0",
        "55.0",
        "186.0",
        "4.0",
        "15.0",
        "63.0",
        "63.0",
        "63.0",
        "107.0",
        "107.0",
        "15.0",
        "6.0",
        "17.0",
        "17.0",
        "17.0",
        "23.0",
        "77.0",
        "77.0",
        "77.0",
        "77.0",
        "91.0",
        "91.0",
        "1589.0",
        "5.0",
        "235.0",
        "270.0",
        "270.0",
        "5.25",
        "10.0",
        "3.0",
        "40.0",
        "20.0",
        "200.0",
        "200.0",
        "200.0",
        "200.0",
        "200.0",
        "105.0",
        "840.0",
        "590.0",
        "590.0",
        "70.0",
        "420.0",
        "420.0",
        "10.0",
        "20.0",
        "35.0",
        "150.0",
        "13.0",
        "43.0",
        "43.0",
    ],
}
test_df = pd.DataFrame(test_dict)
test_df["contract"] = test_df["contract"].str.strip()
orders_list = test_df["contract"].unique().tolist()


async def get_data_from_df(orders: list):
    try:
        data = (
            await Submissions.select(
                Submissions.contract_supplement, Submissions.manager, Submissions.client
            )
            .where(Submissions.contract_supplement.is_in(orders))
            .run()
        )
        contract_data_map = {
            item["contract_supplement"]: {
                "manager": item["manager"],
                "client": item["client"],
            }
            for item in data
        }
        return contract_data_map
    except Exception as e:
        print(f"!!! –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞—Ö –∏ –∫–ª–∏–µ–Ω—Ç–∞—Ö –∏–∑ –ë–î: {e}")
        return {}


async def notifications(bot: Bot):
    # 1. –ü–æ–ª—É—á–∞–µ–º —Å–ª–æ–≤–∞—Ä—å { '–Ω–æ–º–µ—Ä_–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞': '–∏–º—è_–º–µ–Ω–µ–¥–∂–µ—Ä–∞' }
    contract_data_map = await get_data_from_df(orders_list)
    print("--- –°–ª–æ–≤–∞—Ä—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ö–æ–Ω—Ç—Ä–∞–∫—Ç -> –ú–µ–Ω–µ–¥–∂–µ—Ä ---")
    print(contract_data_map)

    # 2. –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É 'manager' –≤ DataFrame, –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥ .map()
    # –°–æ–∑–¥–∞–µ–º –¥–≤–µ –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏: 'manager' –∏ 'client'
    test_df["manager"] = test_df["contract"].map(
        lambda x: contract_data_map.get(x, {}).get("manager")
    )
    test_df["client"] = test_df["contract"].map(
        lambda x: contract_data_map.get(x, {}).get("client")
    )
    # –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–ø—É—Å–∫–∏, –µ—Å–ª–∏ –¥–ª—è –∫–∞–∫–æ–≥–æ-—Ç–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –Ω–µ –Ω–∞—à–µ–ª—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä
    test_df["manager"] = test_df["manager"].fillna("–ú–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω")
    test_df["client"] = test_df["client"].fillna("–ö–ª–∏–µ–Ω—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω")

    # 3. –ì—Ä—É–ø–ø–∏—Ä—É–µ–º DataFrame –ø–æ –Ω–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ 'manager'
    grouped_by_manager = test_df.groupby("manager")

    print("\n--- –î–∞–Ω–Ω—ã–µ, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä—É ---")
    # 4. –ò—Ç–µ—Ä–∏—Ä—É–µ–º—Å—è –ø–æ –≥—Ä—É–ø–ø–∞–º
    for manager_name, manager_group_df in grouped_by_manager:
        # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –≤—Ç–æ—Ä–æ–µ —Å–ª–æ–≤–æ –∏–∑ –§–ò–û, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω–æ–µ –∏–º—è
        informal_manager_name = (
            manager_name.split(" ")[1] if manager_name else "–ö–æ–ª–ª–µ–≥–∞"
        )
        # --- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è Telegram ---
        message_text = f"üëã –î–æ–±—Ä–æ–≥–æ –¥–Ω—è, *{informal_manager_name}*!\n\n"
        message_text += "üÜï –£ –≤–∞—Å —î –Ω–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É:\n"

        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–ø–∏—Å–∏ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞ –¥–ª—è –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –≤–∏–¥–∞
        for order_id, order_group in manager_group_df.groupby("order"):
            # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞ (–æ–Ω–æ –±—É–¥–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –¥–ª—è –≤—Å–µ–π –≥—Ä—É–ø–ø—ã –∑–∞–∫–∞–∑–∞)
            client_name = order_group["client"].iloc[0]
            message_text += (
                f"\n\nüìÑ *–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:* `{order_id}`\n"
                f"üë§ *–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç:* {client_name}\n"
            )

            # --- –ù–û–í–´–ô –£–†–û–í–ï–ù–¨ –ì–†–£–ü–ü–ò–†–û–í–ö–ò: –ø–æ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—é (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É) ---
            for contract_id, contract_group in order_group.groupby("contract"):
                message_text += f"  üìù *–î–æ–ø–æ–≤–Ω–µ–Ω–Ω—è:* `{contract_id}`\n"

                # --- –ù–û–í–´–ô –£–†–û–í–ï–ù–¨ –ì–†–£–ü–ü–ò–†–û–í–ö–ò: –ø–æ —Ç–æ–≤–∞—Ä—É ---
                for product_name, product_group in contract_group.groupby("product"):
                    message_text += f"    üì¶ *–¢–æ–≤–∞—Ä:* _{product_name}_\n"

                    # –ò—Ç–µ—Ä–∏—Ä—É–µ–º—Å—è –ø–æ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ (–ø–∞—Ä—Ç–∏–∏/–ø–æ–∑–∏—Ü–∏–∏) –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
                    for _, row in product_group.iterrows():
                        date_val = row.get("date")
                        formatted_date = (
                            date_val.strftime("%d.%m.%Y")
                            if pd.notna(date_val)
                            else "–Ω–µ –≤–∫–∞–∑–∞–Ω–æ"
                        )

                        message_text += (
                            f"      üè∑Ô∏è *–ü–∞—Ä—Ç—ñ—è:* `{row.get('party_sign', 'N/A')}`\n"
                        )
                        message_text += (
                            f"      üöö *–ü–µ—Ä–µ–º—ñ—â–µ–Ω–æ:* *{row.get('qt_moved', 0)}*\n"
                        )
                        # message_text += f"      üõí *–ó–∞–º–æ–≤–ª–µ–Ω–æ:* {row.get('qt_order', 0)}\n"
                        # message_text += f"      üìà *–ù–∞–ø—Ä—è–º:* {row.get('line_of_business', 'N/A')}\n"
                        # message_text += f"      üóìÔ∏è *–ü–µ—Ä—ñ–æ–¥:* {row.get('period', 'N/A')}\n"
                        # message_text += f"      üìÖ *–î–∞—Ç–∞:* {formatted_date}\n"
                        message_text += (
                            "      " + "---" + "\n"
                        )  # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è –ø–∞—Ä—Ç–∏–π

        # –í—ã–≤–æ–¥–∏–º —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ send_notification)
        try:
            await send_notification(
                bot=bot,
                chat_ids=[
                    548019148,
                ],
                text=message_text,
            )
            print(f"\n--- –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è {manager_name} ---\n")
            print(message_text)
            print(f"\n--- –ö–æ–Ω–µ—Ü —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è {manager_name} ---\n")
        except Exception as e:
            print(f"!!! –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä—É {manager_name}: {e}")


async def main_notifications_runner():
    async with Bot(token=TELEGRAM_BOT_TOKEN) as bot:
        await notifications(bot)


if __name__ == "__main__":
    asyncio.run(main_notifications_runner())
